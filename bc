#!/usr/bin/env python3
# bc [Bullet Point Compacter] - Removes the newlines between the bullet points

# Made for Linux (Windows version commented out below)

import subprocess
import re

# ========== ORIGINAL WINDOWS VERSION (COMMENTED OUT) ==========
# import pyperclip
# import re
#
# def remove_extra_newlines():
#     text = pyperclip.paste()
#     
#     # Remove newlines between bullet points (assuming they start with '- ' or '* ')
#     # cleaned_text = re.sub(r'([*-]\s.*)\n\s*\n([*-]\s)', r'\1\n\2', text)
#     cleaned_text = re.sub(r'([*-]\s.*)\n\s*\n([*-]\s)', r'\1\n\2', text)
#     
#     # Additional ChatGPT content fixes
#     cleaned_text = re.sub(r'#+\s\*\*Key [pP]oints\*\*', '**Key Points**', cleaned_text)    
#     cleaned_text = re.sub(r'#+\sKey [pP]oints', '**Key Points**', cleaned_text)    
#     cleaned_text = re.sub(r'#+\sOverview', '**Overview**', cleaned_text)    
#     cleaned_text = re.sub(r'#+\s\*\*Example\*\*', '**Example**', cleaned_text)    
#     cleaned_text = re.sub(r'#+\sNotes', '**Notes**', cleaned_text)    
#     cleaned_text = re.sub(r'#+\s\*\*Output\*\*', '**Output**', cleaned_text)    
#     cleaned_text = re.sub(r'#+\s\*\*Conclusion\*\*', '**Conclusion**', cleaned_text)    
#     cleaned_text = re.sub(r'#+\sConclusion', '**Conclusion**', cleaned_text)    
#     cleaned_text += "\n\n---\n\n" 
#
#     pyperclip.copy(cleaned_text)
#     print("Processed text copied to clipboard!")
#
# if __name__ == "__main__":
#     remove_extra_newlines()
# ===============================================================


# ========== LINUX VERSION (using wl-clipboard) ==========
def get_clipboard():
    """Get clipboard content using wl-paste"""
    try:
        result = subprocess.run(['wl-paste'], capture_output=True, text=True, check=True)
        return result.stdout
    except (subprocess.CalledProcessError, FileNotFoundError):
        print("Error: Could not read clipboard. Install wl-clipboard: sudo pacman -S wl-clipboard")
        return ""


def set_clipboard(text):
    """Set clipboard content using wl-copy"""
    try:
        subprocess.run(['wl-copy'], input=text, text=True, check=True)
        return True
    except (subprocess.CalledProcessError, FileNotFoundError):
        print("Error: Could not write to clipboard.")
        return False


def remove_extra_newlines():
    text = get_clipboard()
    if not text:
        return False
    
    # Strip trailing newline added by wl-paste
    text = text.rstrip('\n')
    
    # Remove newlines between bullet points (assuming they start with '- ' or '* ')
    cleaned_text = re.sub(r'([*-]\s.*)\n\s*\n([*-]\s)', r'\1\n\2', text)
    
    # Additional ChatGPT content fixes
    cleaned_text = re.sub(r'#+\s\*\*Key [pP]oints\*\*', '**Key Points**', cleaned_text)    
    cleaned_text = re.sub(r'#+\sKey [pP]oints', '**Key Points**', cleaned_text)    
    cleaned_text = re.sub(r'#+\sOverview', '**Overview**', cleaned_text)    
    cleaned_text = re.sub(r'#+\s\*\*Example\*\*', '**Example**', cleaned_text)    
    cleaned_text = re.sub(r'#+\sNotes', '**Notes**', cleaned_text)    
    cleaned_text = re.sub(r'#+\s\*\*Output\*\*', '**Output**', cleaned_text)    
    cleaned_text = re.sub(r'#+\s\*\*Conclusion\*\*', '**Conclusion**', cleaned_text)    
    cleaned_text = re.sub(r'#+\sConclusion', '**Conclusion**', cleaned_text)    
    cleaned_text += "\n\n---\n\n" 

    if set_clipboard(cleaned_text):
        print("âœ“ Bullet points compacted and ChatGPT formatting cleaned")
        return True
    return False


if __name__ == "__main__":
    if not remove_extra_newlines():
        exit(1)
