#!/usr/bin/env python3
# rnn.py (Remove Newlines \n) - Removes the newlines in the text from the clipboard.

# Made for Linux (Windows version commented out below)

import subprocess

# ========== ORIGINAL WINDOWS VERSION (COMMENTED OUT) ==========
# import pyperclip
#
# clipboard = pyperclip.paste()
# clipboard = str(clipboard)
# clipboard = list(clipboard)
#
# for j in range(2):
#     clipboard.append(" ")
# i = 0
# while i < len(clipboard):
#     if i == len(clipboard) - 2:
#         break
#     if (
#         clipboard[i] == " "
#         and clipboard[i + 1] == "\n"
#         and clipboard[i + 2] == "\n"
#     ):
#         i += 1
#         continue
#
#     # Disregard two subsequent newlines
#     elif clipboard[i] == "\n":
#         if (
#             (clipboard[i - 1] == "\n")
#             or (clipboard[i + 1] == "\n")
#         ):
#             i += 1
#             continue
#         else:
#             clipboard[i] = " "
#
#     if clipboard[i] == " " and clipboard[i + 1] == "\n":
#         del clipboard[i]
#         clipboard[i] = " "
#
#     i += 1
# for k in range(2):
#     clipboard.pop()
#
# pocessedText = "".join(clipboard)
# pyperclip.copy(pocessedText)
# ===============================================================


# ========== LINUX VERSION (using wl-clipboard) ==========
def get_clipboard():
    """Get clipboard content using wl-paste"""
    try:
        result = subprocess.run(
            ['wl-paste'],
            capture_output=True,
            text=True,
            check=True
        )
        return result.stdout
    except subprocess.CalledProcessError:
        print("Error: Could not read from clipboard.")
        return ""
    except FileNotFoundError:
        print("Error: wl-paste not found. Please install wl-clipboard:")
        print("  sudo apt install wl-clipboard  (Debian/Ubuntu)")
        print("  sudo dnf install wl-clipboard  (Fedora)")
        print("  sudo pacman -S wl-clipboard    (Arch)")
        return ""


def set_clipboard(text):
    """Set clipboard content using wl-copy"""
    try:
        subprocess.run(
            ['wl-copy'],
            input=text,
            text=True,
            check=True
        )
        return True
    except subprocess.CalledProcessError:
        print("Error: Could not write to clipboard.")
        return False
    except FileNotFoundError:
        print("Error: wl-copy not found. Please install wl-clipboard first.")
        return False


def remove_newlines(text):
    """Remove single newlines from text, preserving double newlines (paragraphs)"""
    clipboard = list(text)
    
    # Add padding to avoid index errors
    for j in range(2):
        clipboard.append(" ")
    
    i = 0
    while i < len(clipboard):
        if i == len(clipboard) - 2:
            break
        
        # Skip space followed by double newlines (preserve paragraph breaks)
        if (
            i + 2 < len(clipboard)
            and clipboard[i] == " "
            and clipboard[i + 1] == "\n"
            and clipboard[i + 2] == "\n"
        ):
            i += 1
            continue

        # Disregard two subsequent newlines (preserve paragraph breaks)
        elif clipboard[i] == "\n":
            if (
                (i > 0 and clipboard[i - 1] == "\n")
                or (i + 1 < len(clipboard) and clipboard[i + 1] == "\n")
            ):
                i += 1
                continue
            else:
                # Replace single newline with space
                clipboard[i] = " "

        # Replace space + newline with space
        if i + 1 < len(clipboard) and clipboard[i] == " " and clipboard[i + 1] == "\n":
            del clipboard[i]
            clipboard[i] = " "

        i += 1
    
    # Remove padding
    for k in range(2):
        clipboard.pop()
    
    return "".join(clipboard)


if __name__ == "__main__":
    # Get clipboard content
    clipboard_text = get_clipboard()
    
    if clipboard_text:
        # Process the text
        processed_text = remove_newlines(clipboard_text)
        
        # Copy back to clipboard
        if set_clipboard(processed_text):
            print("✓ Single newlines removed and copied to clipboard successfully!")
        else:
            print("✗ Failed to copy to clipboard.")
    else:
        print("✗ No text found in clipboard or error reading clipboard.")
